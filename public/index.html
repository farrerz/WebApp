<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.0-rc.2/angular.min.js"></script>
      <script src='js/main.js'></script>

      <link rel="stylesheet" type="text/css" href="css/index.css" />
  </head>

  <style media="screen">
      .rw-cell{
          text-align: center;
          padding: 10px;
      }

  </style>


  <body ng-app='automator'>
    <!-- Navigation -->
    <div ng-controller='MainViewController'>

      <nav class="navbar navbar-default" id='mainNav'>

          <div class="navbar-left">
                <a class="navbar-brand" href="#">
                      <img alt="Brand" class="img-responsive" style="max-width:60px; margin-top: -28px;" src="/images/icon.png">
                </a>
                <div class="navbar-text text-center" id='titleText'> Dashboard</span></div>
          </div>


        <div class="nav nav-pills navbar-right">
            <li>
                <a onclick="pingLocalNetwork()"><span class="glyphicon glyphicon-refresh"></span></a>
            </li>
            <li>
                <a onclick="showSetting()"><span class="glyphicon glyphicon-wrench"></span></a>
            </li>
            <li>
                <a onclick='addItem()'><span class="glyphicon glyphicon-plus"></span></a>
            </li>
        </div>
      </nav>
      <!-- Modal -->
      <!-- Button trigger modal -->

      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header" >
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">Modal title</h4>
            </div>
            <div class="modal-body">
            <form id="addDeviceForm">
              IP Address:<br>
              <input type="text" name="newipaddr"><br>
              <input type="submit" name="">
            </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div>
        </div>
      </div>
        <!-- Main Content -->
    <main>
        <div class="container">
          <div class="row-fluid">
                <div class="col-md-4 rw-cell" ng-repeat='room in rooms' >
                    <div class="panel panel-info">
                      <div class="panel-heading" style="background-color:#EF5350;color:white">
                        <h3 class="panel-title">
                          {{room.roomname}}<a href='#' class="pull-right"><span class="glyphicon glyphicon-cog"></span></a>
                        </h3>
                      </div>
                          <div class="panel-body">
                              <div class="col-md-4 rw-cell" ng-repeat='doutput in room.digitaloutputs' >
                              <p>Stuff that fills this column {{doutput.outputname}}</p>
                              <button type="button" class="digitalButton" value="0" onclick="setPin(this)" id="http://{{room.ipaddr}}/set?pin={{doutput.pin}}&val=">Toggle {{doutput.outputname}}</button>
                          </div>
                    </div>


                </div>
          </div>
        </div>
    </main>
      <!-- Footer Content -->
    <footer>
      <nav class="navbar navbar-default navbar-fixed-bottom" id="bottomNav">
          <div class="container">
            <p class="navbar-text">Copyright (c) 2016 Copyright Holder All Rights Reserved.</p>
          </div>
      </nav>
    </footer>
    <script type="text/javascript">
        function setPin(btn){
          //alert($(btn).attr('id'));
            $.ajax({
                type: 'GET',
                url: $(btn).attr('id')+$(btn).attr('value'),
                timeout: 8000,
                success: function(data) {
                    //alert(data);
                    $("p").text(data.value);
                    if($(btn).val() == "0")
                    {
                      $(btn).val("1");
                    }
                    else{
                      $(btn).val("0");
                    }
                    //$(btn).value()

                }
            });
        };
   $('#addDeviceForm').submit(function(e){
  e.preventDefault();
  //do some verification
  $.ajax({
    url: '/addroom',
    type:'POST',
    data: $(this).serialize(),
    success: function(data)
    {
      //callback methods go right here
    }
  });
});
</script>
    <script type="text/javascript">

        var app = angular.module('automator', []);

        app.controller('MainViewController', ['$scope','$http',function($scope,$http){
          $http.get( "/api/getCells").then(function( response ) {
          $scope.rooms= response.data; //from your sample;
          console.log(response.data);
        });
        }]);
        

    </script>
  </body>
</html>
